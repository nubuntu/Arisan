<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="user-scalable=0, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<link rel="stylesheet" href="light-orange.min.css" />
		<link href="jquery.mobile.structure-1.3.0.min.css" rel="stylesheet">  
		<script src="jquery-1.9.1.min.js" type="text/javascript"></script>
		<script src="jquery.mobile-1.3.0.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="cordova-2.5.0.js"></script>	
        <title>Arisan</title>
    </head>
    <body>
<div data-role="page" id="main" data-theme="b">
	<div data-role="header" id="hdrMain" data-nobackbtn="true" data-position="fixed">
		<h1>Categories</h1>
		<a id="buttonAddCategory" data-icon="plus" class="ui-btn-left" href="" data-role="button" data-inline="true">Add</a>
	</div>	
	<div data-role="content" id="contentMain">
		<ul data-role="listview" data-split-icon="delete" data-split-theme="d"  id="currentNews"></ul>
	</div>
	<div data-role="footer" id="ftrMain" data-position="fixed"></div>
	<!-- login page -->
	<div data-role="header" id="hdrLogin" data-nobackbtn="true" data-position="fixed">
		<h1>Login</h1>
		
	</div>	
	<div data-role="content" id="contentLogin">
		<div id="login">
   			<p><button id="btn-login">Login</button></p>
 		</div>
 		<div id="logout">
   			<p><button  onClick="FB.logout();">Logout</button></p>
 		</div>
	</div>
<script>
document.addEventListener("deviceready", onDeviceReady, false);
var my_client_id  = "426883230735517";
var my_redirect_uri   = "http://www.facebook.com/connect/login_success.html";
var my_type           = "user_agent";
var my_display        = "touch";

function onDeviceReady() {
	var element = $('#contentLogin');
	var $btnlogin = $('#btn-login');
	/**
    element.html('Device Name: '     + device.name     + '<br />' + 
                        'Device PhoneGap: ' + device.phonegap + '<br />' + 
                        'Device Platform: ' + device.platform + '<br />' + 
                        'Device UUID: '     + device.uuid     + '<br />' + 
                        'Device Version: '  + device.version  + '<br />');
	**/
	//document.addEventListener("backbutton", onBackClickEvent, false); // Adding the back button listener    
	$btnlogin.click(function(){
		onPubFacebookBtn();
	});


	//childwindow = window.open('https://graph.facebook.com/me','_blank', 'location=yes');

}
var childwindow;
	function init(){
		hide("Main");
		navigator.splashscreen.hide();
		show("Login");
	}
	function fadein(el,$func){
		$("#hdr" + el).fadeIn('slow',$func);  	
		$("#content" + el).fadeIn('slow',$func);  	
		$("#ftr" + el).fadeIn('slow',$func);  		
	} 	
	function fadeout(el,$func){
		$("#hdr" + el).fadeOut('slow',$func);  	
		$("#content" + el).fadeOut('slow',$func);  	
		$("#ftr" + el).fadeOut('slow',$func);  		
	} 	
	function show(el){
		$("#hdr" + el).show();  	
		$("#content" + el).show();  	
		$("#ftr" + el).show();
		contentHeight(el);
	}
	function hide(el){
		$("#hdr" + el).hide();  	
		$("#content" + el).hide();  	
		$("#ftr" + el).hide();  	
	}	
	function contentHeight(el){
	    var header = $("#hdr" + el);
	    var footer = $("#ftr" + el);
	    var content = $("#content" + el);
	    var viewport_height = $(window).height();		
		var content_height = viewport_height - header.outerHeight() - footer.outerHeight();
		content_height -= (content.outerHeight() - content.height());
		content.height(content_height);
	}
	function onPubFacebookBtn(){ // I call this from a button

		var authorize_url  = "https://graph.facebook.com/oauth/authorize?";
		authorize_url += "client_id="+my_client_id;
		authorize_url += "&redirect_uri="+my_redirect_uri;
		authorize_url += "&display="+my_display;
		authorize_url += "&response_type=token";
		authorize_url += "&scope=publish_stream,user_photos,email,user_online_presence,offline_access";
		//console.log("url_auth:" + authorize_url);
		childwindow = window.open(authorize_url,'_blank', 'location=yes');
        childwindow.addEventListener('loadstop',facebookLocChanged);
		}

		function facebookLocChanged(loc){
		//childwindow.close();
		if (/login_success/.test(loc.url)) { 
		   //var fbCode = loc.url.match(/code=(.*)$/)[1];
		   var id_check = /access_token=([^&]+)/i;
		   var fbToken = id_check.exec(loc.url);
			//console.log(loc.url);
		   console.log("FBToken:" + fbToken[1]);
			//childwindow.close();
		}}	
		function ajaxthis(url){
			$.ajax({
		        url:url, 
		        type: 'POST',
		        success: function(data) {
		    		console.log(data);
		        }
		     });				
		}
</script>

</div>  
</body>
</html>
